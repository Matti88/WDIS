<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="/static/img/bender.ico">

    <title>OCpR tool</title>

    <!-- Bootstrap core CSS -->
    <link href="static/css/bootstrap.css" rel="stylesheet">

</head>

<body>

    <nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top">
        <a class="navbar-brand" href="#">OCpR File Cheker</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault"
            aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarsExampleDefault">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item active">
                    <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
                </li>
                <li class="nav-item active">
                    <a class="nav-link" href="#">Cheker<span class="sr-only">(current)</span></a>
                </li>
                <li class="nav-item active">
                    <a class="nav-link" href="#">Model_Upload<span class="sr-only">(current)</span></a>
                </li>
            </ul>
        </div>
    </nav>

    <main role="main" class="container">

        <div class="container">
            <div class="row">
                <div class="col">

                    <h1>Upload an OCpR Model</h1>
                    <hr>

                    <form id="calcForm" action="/upload-OCpR_file" method="POST" enctype="multipart/form-data">

                        <div class="form-group">
                            <label>Select OCpR_file</label>
                            <div class="custom-file">
                                <input type="file" class="custom-file-input" name="file" id="OCpR_file">
                                <label class="custom-file-label" id="fileLabel" for="OCpR_file">Select file...</label>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary" id="uploadButn">Upload</button>
                    </form>

                </div>

            </div>
        </div>
        <br />
        <div class="container">
            <div class="row">
                <div class="col">

                    <h2>Uploaded Files</h2>
                    <hr>
                    <form id="OCpR_Run_Form" action="/Checker_OCpR_file" method="GET">
                        <div class="form-group">
                            <label>Upload OCpR_file</label>
                            <div class="custom-file">
                                <input type="text" class="custom-file-input" name="fileName" id="OCpR_file2">
                                <label class="custom-file-label" id="loadedUpFile"></label>
                            </div>

                        </div>
                        <button type="submit" class="btn btn-primary" for="OCpR_file2" id="prcsCal">Calculate OCpR</button>
                    </form>

                </div>
            </div>
        </div>

        <div class="container">
            <div style="padding: 25px;">
                <h3>Calculation Output</h3>  
            
                    <p style="padding-top: 10px;">
                        <button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
                          Usage
                        </button>
                        </p>
                      <div class="collapse" id="collapseExample">
                        <div class="card card-body">
                            <p>
                                <strong>How to process a file ?</strong>
                                Upload a file in .xlsx or .csv format and click on 'Process'.
                            </p>
            
                            <p>
                                <strong>Need to process another file ?</strong>
                                If you want to process another file, please reload the page and repeat previous step.
                            </p>
            
                            <p>
                                If there is any issue, please contact Katarina_Bedejova@dell.com
                            </p>
                        </div>
                      </div>
            
            </div>
            
            
            <div class="card ">
                <div class="card-header"> 
                  <ul class="nav nav-tabs card-header-tabs pull-right"  id="myTab" role="tablist">
                    <li class="nav-item">
                     <a class="nav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab" aria-controls="home" aria-selected="true">Output</a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link" id="profile-tab" data-toggle="tab" href="#profile" role="tab" aria-controls="profile" aria-selected="false">Warnings<span class="badge badge-light">{{warning_count}}</span></a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link" id="contact-tab" data-toggle="tab" href="#contact" role="tab" aria-controls="contact" aria-selected="false">Errors<span class="badge badge-light">{{error_count}}</span></a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="est-tab" data-toggle="tab" href="#est">Estimation</a>
                      </li>
                  </ul>
                </div>
                <div class="card-body">
                    <div class="tab-content" id="myTabContent">
                        <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">
                            <div id="target_div" style="overflow-y: scroll; height: 300px;">
                                <div id="output-main">
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="profile-tab">
                            <div id="target_div_warnings" style="overflow-y: scroll; height: 300px;">
                                <div id="output-warnings">
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="contact" role="tabpanel" aria-labelledby="contact-tab">
                            <div id="target_div_errors" style="overflow-y: scroll; height: 300px;">
                                <div id="output-errors">
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="est" role="tabpanel" aria-labelledby="est-tab">
                            <div id="target_div_est" style="overflow-y: scroll; height: 300px;">
                                <div id="output-estimation">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
              </div>
            
        </div>
    </main><!-- /.container -->

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="static/js/jquery-3.js" type="text/javascript" ></script>
    <script>
        window.jQuery || document.write('<script src="static/js/jquery-3.js"><\/script>')
    </script>
    <script src="static/js/popper.js" language="javascript" mimetype="text/javascript"></script>
    <script src="static/js/bootstrap.js" language="javascript" mimetype="text/javascript"></script>

    <script language="javascript" type="text/javascript">
        $("#OCpR_file").change(function () {
            var pathLoaded = this.value.replace("C:\\fakepath\\", "");
            $('#fileLabel').text(pathLoaded);
        });

        $("#uploadButn").click(
            function () {
                var _text = $('#fileLabel').text();
                $('#loadedUpFile').text(_text);
                $('#OCpR_file2').val(_text);
                $('#fileLabel').text("Select file...");
            });


$("#OCpR_Run_Form").submit(function(event) {
        event.stopPropagation();
        event.preventDefault();
        console.log($("#loadedUpFile").value)
        $.ajax({
        url: $(this).attr("action"),
        data:  "fileName=" + $("#loadedUpFile").text() ,
        processData: false,
        contentType: false,
        type: 'GET',
        success: function(data) {
            console.log('A message has arrived!');              
            var obj3 = $.parseJSON(data);
            console.log(obj3);
 
            $('#output-main').empty();
            $('#output-warnings').empty();
            $('#output-errors').empty();
            $('#output-estimation').empty();

            main_new_par = x => $('#output-main').append('<p>'+x+'</p>');
            warn_new_par = x => $('#output-warnings').append('<p>'+x+'</p>');
            err_new_par = x =>$('#output-errors').append('<p>'+x+'</p>');
            
            obj3.main.forEach(main_new_par);
            obj3.warn.forEach(warn_new_par);
            obj3.err.forEach(err_new_par);


            $('#output-estimation').append('<p>'+obj3.est+'</p>');
            $('#loadedUpFile').text(""); 
            
        }})});

    </script>

</body>

</html>